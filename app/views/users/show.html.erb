<div class="banner" >
  <div class="container page-body">
    <div class="profile-card">
      <div class="profile-avatar">
        <div>
          <% avatar_url = @user.facebook_picture_url || "#{@user.avatar}" %>
          <%= image_tag avatar_url, class: "rounded-circle user-profile-avatar" %>
        </div>
      </div>
      <div>
        <h3><%= @user.first_name %></h3>
        <p><%= @user.country %></p>
      </div>
    </div>
    <div class="about-section">
      <div class="about-title">
        <div class="d-flex top-panel">
          <% if current_user == @user %>
          <%= link_to "", edit_user_registration_path, class: "far fa-edit" %>
          <% end %>
          <% if current_user == @user %>
          <h6><%= "My Profile" %></h6>
          <% else %>
          <h6>About <%= "#{@user.first_name}" %></h6>
          <% end %>
          <%= link_to "", points_path, class: "fas fa-globe-europe"  %>
        </div>
        <div class="stats-section">
          <div class="row">
             <div class="stats-block">
                <p class="mb-3"><strong>Life Distance</strong></p>
                  <% total_distance = 0.0 %>
                  <% @user.trips.each do |trip| %>
                    <% total_distance += trip.distance %>
                  <% end %>
                   <p><%= (total_distance).round %> km</p>
                <div class="stats-card ml-2">
                <i class="fas fa-calculator"></i>
             </div>
            </div>
            <div class="stats-block">
                <p class="mb-3"><strong>Hours Ridden</strong></p>
                <% total_duration = 0.0 %>
                  <% @user.trips.each do |trip| %>
                    <% total_duration += trip.duration %>
                  <% end %>
                  <p><%= (total_duration).round %> hr</p>
              <div class="stats-card">
                <i class="fas fa-stopwatch"></i>
              </div>
            </div>
            <div class="stats-block">
                <p class="mb-3"><strong>Longest ride</strong></p>
                <p><%= @user.trips.max.distance.round %> km</p>
              <div class="stats-card">
                <i class="fas fa-road"></i>
              </div>
            </div>
          </div>
          <div class="rider-bio">
            <h6>User bio</h6>
            <p><%= @user.bio %></p>
          </div>
          <div class="journey-section">
            <% if current_user == @user %>
            <h6>My Journey</h6>
            <% else %>
            <h6><%= @user.first_name %>'s Journey</h6>
            <% end %>
          </div>
            <div class="accordion mb-5" id="accordionExample">
              <div class="card">
                <div class="card-header panel-heading" data-toggle="collapse" data-target="#collapseOne" id="headingOne">
                  <h5 class="mb-0">
                    <!-- <button class="btn btn-link" type="button"  aria-expanded="true" aria-controls="collapseOne"> -->
                      Routes
                    <!-- </button> -->
                  </h6>
                </div>
                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                  <div class="card-body">
                    <%# raise %>
                    <%= @user.trips %>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header panel-heading" data-toggle="collapse" data-target="#collapseThree" id="headingThree">
                  <h5 class="mb-0">
                    <!-- <button class="btn btn-link collapsed" type="button"  aria-expanded="false" aria-controls="collapseThree"> -->
                      Points
                    <!-- </button> -->
                  </h6>
                </div>
                <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                  <div class="card-body">
                      <% @user.points.each do |point| %>
                    <div class="dropdown-card my-3">
                      <%= link_to point_path(point) do  %>
                       <%= cl_image_tag point.photo, height: 100, width: 130, class: "card-image" %>
                       <% end %>
                       <div>
                         <p><strong><%=  point.name %></strong></p>
                         <p><%= point.category %></p>
                         <p><%= point.description.truncate(40)%></p>
                       </div>
                    </div>
                     <% end %>
                  </div>
                </div>
              </div>
               <div class="card">
                <div class="card-header panel-heading" data-toggle="collapse" data-target="#collapseTwo" id="headingTwo">
                  <h5 class="mb-0">
                    <!-- <button class="btn btn-link collapsed" type="button"  aria-expanded="false" aria-controls="collapseTwo"> -->
                      Posts
                    <!-- </button> -->
                  </h6>
                </div>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                  <div class="card-body">
                      <% @user.posts.each do |p| %>
                    <div class="dropdown-card my-3">
                      <p><strong><%= p.title %></strong></p>
                        </p>
                      <br>
                      <p><%= p.content %></p>
                      <p><%= link_to "#{p.point.name}", point_path(p.point_id) %></p>
                      <p><%#= link_to "See point",  %></p>
                    </div>
                      <% end %>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>

